(function(a){a.su.Widget("combobox",{defaults:{fieldLabel:"",tips:"",cls:"",readOnly:true,noneSelectedText:(js_no_selected_text="-Please Select-"),multiSelect:false,displayField:"name",valueField:"value",items:null,store:null,isCombobox:true,widgetName:"combobox"},create:function(f,d){var e=this;e.each(function(k,j){var o=a(j);a.extend(j,f,d);a.su.Widget.selectZindex=a.su.Widget.selectZindex?a.su.Widget.selectZindex:10000;if(o.is("select")){var l=o.find("option");j.items=j.items||[];for(var m=0,n=l.length;m<n;m++){j.items.push({value:l[m].value,name:l[m].innerHTML,selected:l[m].selected?"selected":false,_bFromSel:true})}}var g='<div style="z-index: '+(a.su.Widget.selectZindex--)+';position:relative;" class="container widget-container combobox-container '+(j.multiSelect?"multiple":"single")+" "+j.cls+" "+(j.className||"")+'">';if(this.fieldLabel!==null&&this.fieldLabel.length>0){g+='<div class="widget-fieldlabel-wrap '+this.labelCls+'">';g+='<label class="widget-fieldlabel combobox-fieldlabel">'+this.fieldLabel+"</label>";if(this.fieldLabel!==""){g+='<span class="widget-separator">'+this.separator+"</span>"}g+="</div>"}g+='<div class="widget-wrap combobox-wrap">';g+='<input class="combobox-text '+j.inputCls+'" type="text" readOnly="true" value="'+j.noneSelectedText+'" />';g+='<a class="combobox-switch" href="javascript:void(0);"></a>';g+='<div class="combobox-list-wrap">';g+='<ul class="combobox-list">';g+="</ul>";g+="</div>";g+="</div>";g+='<span class="widget-tips combobox-tips">'+j.tips+"</span>";g=="</div>";var h=a(g);o.replaceWith(h);h.get(0).insertBefore(o.addClass("hidden combobox-value").get(0),h.get(0).firstChild);if(o.attr("onclick")||o.attr("onchange")){var p=o.get(0).onclick||o.get(0).onchange;e.on("ev_change",p)}e.combobox("setText")});var b=null;if(e.hasClass("div.combobox-container")){b=e}else{b=e.closest("div.combobox-container")}b.delegate("a.combobox-switch","click",function(i){i.stopPropagation();var g=a(this);wrap=g.next("div.combobox-list-wrap"),b=g.closest("div.combobox-container"),toggleFlag=wrap.attr("toggleflag")||"hidden",combobox=b.find("input.combobox-value, select.combobox-value");if(b.hasClass("disabled")){return false}a("div.combobox-list-wrap").hide().attr("toggleflag","hidden");if(toggleFlag==="hidden"){var h=parseInt(wrap.css("max-height"));if(wrap.height()>h){wrap.height(h)}wrap.slideDown(150,function(){wrap.css("overflow-y","auto")});wrap.attr("toggleflag","shown")}else{wrap.hide();wrap.attr("toggleflag","hidden")}a("div.combobox-container").removeClass("selected");if(combobox.get(0).onfocus){combobox.get(0).onfocus()}}).delegate("label.combobox-label","click",function(l){l.stopPropagation();l.preventDefault();var h=a(this),k=a(this).closest("li.combobox-list");listWrap=h.parents("div.combobox-list-wrap"),b=h.closest("div.combobox-container"),_selectType=h.attr("type"),combobox=b.find("input.combobox-value, select.combobox-value");if(k.hasClass("disabled")){return}var j=combobox.combobox("getValue").sort();if(_selectType!=="multiple"){var g=listWrap.find("li.combobox-list").removeClass("selected").find("input.combobox-checkbox");g.each(function(n,o){o.checked=false});k.addClass("selected");h.children("input.combobox-checkbox").get(0).checked=true;listWrap.hide().attr("toggleflag","hidden")}else{var i=h.children("input.combobox-checkbox").get(0);if(i.checked){i.checked=false;k.removeClass("selected")}else{i.checked=true;k.addClass("selected")}}var m=combobox.combobox("getValue").sort();b.addClass("selected");combobox.combobox("setText").val(m);if(j.toString()!=m.toString()){combobox.trigger("ev_change",[j,m])}});b.delegate("input.combobox-text","focus",function(g){a(this).textbox("setFocus")}).delegate("input.combobox-text","keyup blur",function(g){a(this).textbox("validate")}).delegate("input.combobox-text","validatechange",function(h,g){if(g){a(this).textbox("setNormal")}else{a(this).textbox("setError")}});var c=e.get(0).items;if(c){e.combobox("initItems",c)}return e},rebuild:function(e){var e=e||this,g=e.find("option"),f=e.get(0);container=e.closest("div.combobox-container");if(!e.is("select")){console.error("Combobox rebuild must call by select widge!");return null}container.find("ul.combobox-list").empty();f.items=[];for(var d=0,b=g.length;d<b;d++){f.items.push({value:g[d].value,name:g[d].innerHTML,selected:g[d].selected?"selected":false})}var c=f.items;if(c){e.combobox("initItems",c)}return e},initItems:function(j,m){var j=j||this,b=j.closest("div.combobox-container"),d=j.get(0),i=m[1],o=i[0];var l=d.multiSelect==true?"multiple":"single",n="",q,h,p,e,k,c;for(var g=0,f=i.length;g<f;g++){o=i[g];q=d.id+"-"+a.su.randomId("option"),h=o[d.displayField],p=o[d.valueField],e=o.disabled?true:false,k=o.selected?true:false,c=o.cls||"";n+='<li class="combobox-list '+c+" "+(e?"disabled":"")+" "+(k?"selected":"")+'">';n+='<label for="'+q+'" type="'+l+'" class="combobox-label '+l+'">';n+='<input id="'+q+'" display="'+h+'" class="combobox-checkbox" type="checkbox" value="'+p+'"'+(k?' checked="checked"':"")+" "+(e?'disabled="disabled"':"")+" />";n+='<span class="icon"></span>';n+='<span class="text">'+h+"</span>";n+="</label>";n+="</li>";if(j.is("select")&&o._bFromSel!=true){j.append('<option value="'+p+'">'+h+"</option>")}}b.find("ul.combobox-list").append(a(n));j.combobox("setText")},initItem:function(g,j){var g=g||this,b=g.closest("div.combobox-container"),d=g.get(0),l=j[1];var i=d.multiSelect==true?"multiple":"single",n=d.id+"-"+a.su.randomId("option"),f=l[d.displayField],m=l[d.valueField],e=l.disabled?true:false,h=l.selected?true:false,c=l.cls||"";var k="";k+='<li class="combobox-list '+c+" "+(e?"disabled":"")+" "+(h?"selected":"")+'">';k+='<label for="'+n+'" type="'+i+'" class="combobox-label '+i+'">';k+='<input id="'+n+'" display="'+f+'" class="combobox-checkbox" type="checkbox" value="'+m+'"'+(h?' checked="checked"':"")+" "+(e?'disabled="disabled"':"")+" />";k+='<span class="icon"></span>';k+='<span class="text">'+f+"</span>";k+="</label>";k+="</li>";b.find("ul.combobox-list").append(a(k));if(g.is("select")&&l._bFromSel!=true){g.append('<option value="'+m+'">'+f+"</option>")}g.combobox("setText")},hideOptions:function(c){var c=c||this,b=c.combobox("getContainer");b.find("div.combobox-list-wrap").attr("toggleflag","hidden")},setText:function(g,c){var g=g||this,b=g.combobox("getContainer"),f=b.find("input.combobox-checkbox"),h=b.find("input.combobox-text");var k=g.combobox("getValue"),d=a.type(k),j="";if(d==="array"){for(var e=0;e<k.length;e++){var i=f.filter("[value='"+k[e]+"']").nextAll("span.text").text();j=j+i+",\x20"}j=j.slice(0,j.length-2)}else{if(d==="string"){var i=f.filter("[value='"+k+"']").nextAll("span.text").html();j=i}}if(j==""){h.val(g.get(0).noneSelectedText)}else{h.val(j)}return g},getSelectedText:function(b){var b=b||this,c=b.combobox("getContainer").find("input.combobox-text");return c.val()},setValue:function(e,f){var e=e||this,c=e.combobox("getContainer"),b=e.combobox("getContainer").find("input.combobox-checkbox"),f=f[1];if(!a.isArray(f)){f=[f]}var g={};for(var d=0;d<f.length;d++){g[f[d]]=true}c.find("input.combobox-value, select.combobox-value").val(f);b.each(function(h,k){var j=a(k);if(j.val() in g){j.prop("checked",true);j.closest("li.combobox-list").addClass("selected")}else{j.prop("checked",false);j.closest("li.combobox-list").removeClass("selected")}});e.combobox("setText");return e},getValue:function(d){var d=d||this,c=d.combobox("getContainer").find("input.combobox-checkbox");var b=[];c.each(function(e,f){if(f.checked){b.push(a(f).val())}});return b},disable:function(c){var c=c||this,b=c.combobox("getContainer");b.addClass("disabled");b.find("input.combobox-text").attr("disabled",true);return c},enable:function(c){var c=c||this,b=c.combobox("getContainer");b.removeClass("disabled");b.find("input.combobox-text").removeAttr("disabled");return c},disableItem:function(e,d){var e=e||this,c=e.combobox("getContainer"),b=c.find("input.combobox-checkbox"),d=d[1];if(a.type(d)==="string"){d=[d]}var f=(function(){var h={};for(var g=0;g<d.length;g++){h[d[g]]=true}return h})();b.each(function(h,j){var g=a(j);if(g.val() in f){g.closest("li.combobox-list").addClass("disabled");g.attr("disabled",true)}});e.combobox("setText");return e},hiddenItem:function(e,d){var e=e||this,c=e.combobox("getContainer"),b=c.find("input.combobox-checkbox"),d=d[1];if(a.type(d)==="string"){d=[d]}var f=(function(){var h={};for(var g=0;g<d.length;g++){h[d[g]]=true}return h})();b.each(function(h,j){var g=a(j);if(g.val() in f){g.closest("li.combobox-list").addClass("hidden");g.attr("hidden",true)}});e.combobox("setText");return e},enableItem:function(e,d){var e=e||this,c=e.combobox("getContainer"),b=c.find("input.combobox-checkbox"),d=d[1];if(a.type(d)==="string"){d=[d]}var f=(function(){var h={};for(var g=0;g<d.length;g++){h[d[g]]=true}return h})();b.each(function(h,j){var g=a(j);if(g.val() in f){g.closest("li.combobox-list").removeClass("disabled");g.attr("disabled",false)}});e.combobox("setText");return e},select:function(f,d){var f=f||this,g=f.get(0),c=f.combobox("getContainer"),b=c.find("input.combobox-checkbox"),d=d[1];var e=f.combobox("getValue").sort();if(a.type(d)==="string"||a.type(d)==="number"){d=[d]}if(g.multiSelect){var i=(function(){var k={};for(var j=0;j<d.length;j++){k[d[j]]=true}return k})();b.each(function(k,l){var j=a(l);if(j.val() in i){j.closest("li.combobox-list").addClass("selected");l.checked=true}})}else{if(d.length>0){d=d[0]}b.each(function(k,l){var j=a(l);if(j.val()==d){j.closest("li.combobox-list").addClass("selected");l.checked=true}else{j.closest("li.combobox-list").removeClass("selected");l.checked=false}})}var h=f.combobox("getValue").sort();if(e.toString()!=h.toString()){f.trigger("ev_change",[e,h])}f.combobox("setText").val(h);return f},selWithoutTrigger:function(e,d){var e=e||this,f=e.get(0),c=e.combobox("getContainer"),b=c.find("input.combobox-checkbox"),d=d[1];if(a.type(d)==="string"||a.type(d)==="number"){d=[d]}if(f.multiSelect){var g=(function(){var i={};for(var h=0;h<d.length;h++){i[d[h]]=true}return i})();b.each(function(j,k){var h=a(k);if(h.val() in g){h.closest("li.combobox-list").addClass("selected");k.checked=true}})}else{if(d.length>0){d=d[0]}b.each(function(j,k){var h=a(k);if(h.val()==d){h.closest("li.combobox-list").addClass("selected");k.checked=true}else{h.closest("li.combobox-list").removeClass("selected");k.checked=false}})}e.combobox("setText").val(d);return e}})})(jQuery);